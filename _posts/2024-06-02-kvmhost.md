apt install openvswitch-switch
apt install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virt-manager -y


mkdir -p /var/lib/libvirt/vms

<pool type='dir'>
  <name>vms01</name>
  <target>
    <path>/var/lib/libvirt/vms01</path>
  </target>
</pool>

virsh pool-define pool_vms01.xml

virsh pool-start vms01
virsh pool-autostart vms01


ovs-vsctl add-br br-infra
ovs-vsctl add-port br-infra eno1

systemctl restart openvswitch-switch

ovs-vsctl show


  <network>
    <name>home-servers</name>
    <forward mode='bridge'/>
    <bridge name='br-infra'/>
    <virtualport type='openvswitch'/>
    <vlan>
      <tag id='2081'/>
    </vlan>
  </network>

virsh net-define net.home-servers.xml

virsh net-start home-servers
virsh net-autostart home-servers




virt-install \
  --name vm1 \
  --ram 2048 \
  --vcpus 2 \
  --disk pool=vms01,size=20,format=qcow2 \
  --os-variant ubuntu20.04 \
  --network network=home-servers,model=virtio \
  --graphics vnc,listen=0.0.0.0 \
  --console pty,target_type=serial \
  --location 'http://archive.ubuntu.com/ubuntu/dists/focal/main/installer-amd64/' \
  --extra-args 'console=ttyS0,115200n8 serial'


virt-install \
  --name ubuntu24-server \
  --ram 2048 \
  --vcpus 2 \
  --disk pool=vms01,size=20,format=qcow2 \
  --os-variant ubuntu24.04 \
  --network network=home-servers,model=virtio \
  --graphics vnc,listen=0.0.0.0 \
  --console pty,target_type=serial \
  --location 'http://archive.ubuntu.com/ubuntu/dists/lunar/main/installer-amd64/' \
  --extra-args 'console=ttyS0,115200n8 serial'


--disk /var/lib/libvirt/images/seed.iso,device=cdrom \


virt-install \
  --name tvheadend \
  --ram 4096 \
  --vcpus 2 \
  --disk pool=vms01,backing_store=/var/lib/libvirt/images/noble-server-cloudimg-amd64.img,format=qcow2,size=50\
  --os-variant ubuntu24.04 \
  --network network=home-servers,model=virtio \
  --graphics vnc,listen=0.0.0.0 \
  --cloud-init=root-password-generate=on,disable=on,user-data=./user-data.yml,meta-data=./meta-data.yml\
  --console pty,target_type=serial \
  --import 


tvheadend:6iPYgvcQ8J9wqSZ2


# Desktop image build 
virt-install \
  --name no2 \
  --ram 4096 \
  --vcpus 2 \
  --disk pool=vms01,size=20,format=qcow2 \
  --os-variant ubuntu-lts-latest \
  --network network=home-servers,model=virtio \
  --graphics vnc,listen=0.0.0.0 \
  --cdrom ./ubuntu-24.04-desktop-amd64.iso \
  --console pty,target_type=serial
  --cloud-init=root-password-generate=on,disable=on




virt-install \
--boot firmware=efi,loader_secure=yes,menu=on \
--cdrom ./ubuntu-24.04-desktop-amd64.iso \
--vcpus sockets=1,cores=2 --cpu host-passthrough \
--graphics vnc,port=5999,listen=0.0.0.0 \
--sound ich9 \
--video qxl \
--memballoon virtio \
--name exc10 \
  --os-variant ubuntu-lts-latest \
--network network=default,model=virtio \
--ram 4096 \
--controller=scsi,model=virtio-scsi \
--disk path=./ubuntu-desktop-24.04.img,size=20,format=qcow2,device=disk,target.bus=virtio,driver.discard=unmap,cache=writeback,driver.io=threads 
